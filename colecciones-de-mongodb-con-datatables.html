<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Sitio Web de David León - Presentando colecciones de MongoDB con Datatables</title>
    <meta description="Publicación de noticias, tips y tutoriales de programación y tecnologías de la información" />
    <meta name="author" content="David León">
    <meta author="David León" />
    <link rel="icon" href="./theme/favicon.ico">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <link href="./theme/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="./theme/assets/css/materialkit.css" rel="stylesheet"/>
    <link href="./theme/assets/css/main.css" rel="stylesheet"/>
</head>

<body>
<nav class="navbar navbar-fixed-top navbar-color-on-scroll">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://davfl.com.mx/">David León</a>
        </div>

        <div class="collapse navbar-collapse" id="navigation-example">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/archives.html">
                        <i class="fa fa-archive"></i> Base de Conocimientos
                    </a>
                </li>
                <li>
                    <a href="https://poetadeocasion.wordpress.com/" title="Blog" target="_blank">
                        <i class="fa fa-heart-o"></i> d'Ocasión
                    </a>
                </li>
                <li>
                    <a href="https://haridandleon.wordpress.com/" title="Entretenimiento" target="_blank">
                        <i class="fa fa-rebel"></i> Otros
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/jelidleon" target="_blank" class="btn btn-simple btn-white btn-just-icon">
                        <i class="fa fa-twitter"></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/eisenheimjelid/" target="_blank" class="btn btn-simple btn-white btn-just-icon">
                        <i class="fa fa-github"></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.tumblr.com/blog/jelid" target="_blank" class="btn btn-simple btn-white btn-just-icon">
                        <i class="fa fa-tumblr"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>    <div class="wrapper">
        <div class="header header-filter article-head" style="background-image: url('./theme/assets/img/background.jpg');">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="title">Presentando colecciones de MongoDB con Datatables</h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="main main-raised">
            <div class="container"><br />
            <div class="row">
                    <div class="col-sm-8 col-md-8 col-sx-12 col-lg-9">
                    <div class="article-contenido">
                        <p>Voy a compartir con ustedes, un abstracto de un código que realizó mi conocido <a href="https://twitter.com/joel1r" title="Twitter de Joel Rivera">Joel Rivera</a>, para realizar la presentación de colecciones de datos en <strong>MongoDB</strong>, con <strong>PHP</strong> utilizando <strong>Datatables</strong>. Así que manos a la obra.</p>
<p><img alt="MongoDB" src="/theme/assets/img/mongodb_logo.png"></p>
<p>Empezando por el inicio, el código HTML que va a presentar el Datatables y el contenido de las coleciones de MongoDB, es el siguiente:</p>
<h3>mongodb.html</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>DataTables mongoDB<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.3.1.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>you can use the file <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>datatables_mongodb.json<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span> to load a colection example<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">table</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;example&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width:100%&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>CAMPO 1<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>CAMPO 2<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>CAMPO 3<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>CAMPO 4<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>CAMPO 5<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#example&#39;</span><span class="p">).</span><span class="nx">DataTable</span><span class="p">(</span> <span class="p">{</span>
        <span class="s2">&quot;processing&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;serverSide&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;ajax&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;./server_processing_mongodb.php&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dataType&quot;</span><span class="o">:</span> <span class="s2">&quot;jsonp&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="c1">//indicate the names of fields how apeart in mongo collection</span>
    <span class="s2">&quot;columns&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;campo_1&quot;</span><span class="p">},</span>
            <span class="p">{</span> <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;campo_2&quot;</span><span class="p">},</span>
            <span class="p">{</span> <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;campo_3&quot;</span><span class="p">},</span>
            <span class="p">{</span> <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;campo_4&quot;</span><span class="p">},</span>
            <span class="p">{</span> <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;campo_5&quot;</span><span class="p">}</span>
        <span class="p">]</span>
<span class="p">});</span>
<span class="p">}</span> <span class="p">);</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>


<p>Ahora, el código que realiza el procesamiento de los datos y conecta a MongoDB es el siguiente:</p>
<h3>mongodb.html</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;memory_limit&#39;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">);</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;display_startup_errors&#39;</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
<span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;America/Mexico_City&#39;</span><span class="p">);</span>

<span class="sd">/**</span>
<span class="sd"> * data to modify for it to work</span>
<span class="sd"> */</span>
<span class="nv">$database</span>   <span class="o">=</span> <span class="s1">&#39;database&#39;</span><span class="p">;</span> <span class="c1">//indicate the name of data base</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="s1">&#39;collection&#39;</span><span class="p">;</span> <span class="c1">//indicate the name of collection</span>

<span class="sd">/**</span>
<span class="sd"> * MongoDB connection</span>
<span class="sd"> */</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Manager</span><span class="p">(</span><span class="s2">&quot;mongodb://localhost:27017&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">MongoConnectionException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error connecting to MongoDB server&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="sd">/**</span>
<span class="sd"> * get the parameters of the call</span>
<span class="sd"> */</span>
<span class="nv">$input</span> <span class="o">=&amp;</span> <span class="nv">$_GET</span><span class="p">;</span> 
<span class="sd">/**</span>
<span class="sd"> * get columns</span>
<span class="sd"> */</span>
<span class="nv">$columnas</span><span class="o">=</span><span class="p">[];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$cl</span><span class="p">){</span>
    <span class="nb">array_push</span><span class="p">(</span><span class="nv">$columnas</span><span class="p">,</span><span class="nv">$cl</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * generate custom filter</span>
<span class="sd"> */</span>

<span class="nv">$condicion</span><span class="o">=</span><span class="p">[];</span>
<span class="nv">$iColumns</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">]);</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nv">$iColumns</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])){</span>
           <span class="nv">$condicion</span><span class="p">[</span><span class="nv">$columnas</span><span class="p">[</span><span class="nv">$i</span><span class="p">]]</span><span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]);</span> 
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$condicion</span><span class="p">[</span><span class="nv">$columnas</span><span class="p">[</span><span class="nv">$i</span><span class="p">]]</span><span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
        <span class="p">}</span>        
    <span class="p">}</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * search in table</span>
<span class="sd"> */</span>
<span class="nv">$search</span> <span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
<span class="nv">$base</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$search</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">){</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$columnas</span> <span class="k">as</span> <span class="nv">$cl</span><span class="p">){</span>
        <span class="nv">$base</span><span class="p">[]</span><span class="o">=</span> <span class="p">[</span><span class="nv">$cl</span><span class="o">=&gt;</span><span class="p">[</span><span class="s1">&#39;$regex&#39;</span><span class="o">=&gt;</span><span class="nv">$search</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="nv">$condicion</span><span class="p">[</span><span class="s1">&#39;$or&#39;</span><span class="p">]</span><span class="o">=</span><span class="nv">$base</span><span class="p">;</span>
<span class="p">}</span>
<span class="sd">/**</span>
<span class="sd"> * order</span>
<span class="sd"> */</span>
<span class="nv">$sort</span><span class="o">=</span><span class="p">[];</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;asc&quot;</span><span class="p">){</span><span class="nv">$dir</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span><span class="k">else</span><span class="p">{</span><span class="nv">$dir</span><span class="o">=-</span><span class="mi">1</span><span class="p">;}</span>
<span class="nv">$sort</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nv">$columnas</span><span class="p">[</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;column&#39;</span><span class="p">]]</span><span class="o">=&gt;</span><span class="nv">$dir</span><span class="p">);</span>
<span class="sd">/**</span>
<span class="sd"> * total results</span>
<span class="sd"> */</span>
<span class="nv">$total</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="nv">$recordsTotal</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$condicion</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
    <span class="nv">$option</span><span class="o">=</span><span class="k">array</span><span class="p">([</span><span class="s1">&#39;$count&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;total&#39;</span><span class="p">]);</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nv">$option</span><span class="o">=</span><span class="k">array</span><span class="p">([</span><span class="s1">&#39;$match&#39;</span> <span class="o">=&gt;</span> <span class="nv">$condicion</span><span class="p">],[</span><span class="s1">&#39;$count&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;total&#39;</span><span class="p">]);</span>  
<span class="p">}</span>
<span class="nv">$command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Command</span><span class="p">([</span>
    <span class="s1">&#39;aggregate&#39;</span> <span class="o">=&gt;</span> <span class="nv">$collection</span><span class="p">,</span>
    <span class="s1">&#39;pipeline&#39;</span> <span class="o">=&gt;</span> <span class="nv">$option</span><span class="p">,</span>
    <span class="s1">&#39;allowDiskUse&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="s1">&#39;cursor&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$totales</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">executeCommand</span><span class="p">(</span><span class="nv">$database</span><span class="p">,</span> <span class="nv">$command</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$totales</span> <span class="k">as</span> <span class="nv">$d</span><span class="p">){</span>
    <span class="nv">$total</span> <span class="o">=</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">total</span><span class="p">;</span>
<span class="p">}</span>
<span class="sd">/**</span>
<span class="sd"> * Total records in collection</span>
<span class="sd"> */</span>
<span class="nv">$command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Command</span><span class="p">([</span>
    <span class="s1">&#39;aggregate&#39;</span> <span class="o">=&gt;</span> <span class="nv">$collection</span><span class="p">,</span>
    <span class="s1">&#39;pipeline&#39;</span> <span class="o">=&gt;</span> <span class="p">[[</span><span class="s1">&#39;$count&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;total&#39;</span><span class="p">]],</span>
    <span class="s1">&#39;allowDiskUse&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="s1">&#39;cursor&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$totalesx</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">executeCommand</span><span class="p">(</span><span class="nv">$database</span><span class="p">,</span> <span class="nv">$command</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$totalesx</span> <span class="k">as</span> <span class="nv">$d</span><span class="p">){</span>
   <span class="nv">$recordsTotal</span><span class="o">=</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">total</span><span class="p">;</span>
<span class="p">}</span>
<span class="sd">/**</span>
<span class="sd"> * filtering and paging</span>
<span class="sd"> */</span>
<span class="nv">$project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$columnas</span> <span class="k">as</span> <span class="nv">$col</span><span class="p">){</span>
    <span class="nv">$project</span><span class="p">[</span><span class="nv">$col</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$condicion</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
    <span class="nv">$optionx</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>       
        <span class="p">[</span><span class="s1">&#39;$skip&#39;</span> <span class="o">=&gt;</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])],</span>
        <span class="p">[</span><span class="s1">&#39;$project&#39;</span><span class="o">=&gt;</span><span class="nv">$project</span><span class="p">],</span>             
        <span class="p">[</span><span class="s1">&#39;$limit&#39;</span><span class="o">=&gt;</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])],</span>
        <span class="p">[</span><span class="s1">&#39;$sort&#39;</span><span class="o">=&gt;</span><span class="nv">$sort</span><span class="p">],</span>
    <span class="p">);</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nv">$optionx</span><span class="o">=</span><span class="k">array</span><span class="p">(</span> 
        <span class="p">[</span><span class="s1">&#39;$match&#39;</span><span class="o">=&gt;</span><span class="nv">$condicion</span><span class="p">],</span>        
        <span class="p">[</span><span class="s1">&#39;$skip&#39;</span> <span class="o">=&gt;</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])],</span>
        <span class="p">[</span><span class="s1">&#39;$project&#39;</span><span class="o">=&gt;</span><span class="nv">$project</span><span class="p">],</span>            
        <span class="p">[</span><span class="s1">&#39;$limit&#39;</span><span class="o">=&gt;</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])],</span>
        <span class="p">[</span><span class="s1">&#39;$sort&#39;</span><span class="o">=&gt;</span><span class="nv">$sort</span><span class="p">],</span> 

    <span class="p">);</span>
<span class="p">}</span>

<span class="nv">$command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Command</span><span class="p">([</span>
    <span class="s1">&#39;aggregate&#39;</span> <span class="o">=&gt;</span> <span class="nv">$collection</span><span class="p">,</span>
    <span class="s1">&#39;pipeline&#39;</span> <span class="o">=&gt;</span> <span class="nv">$optionx</span><span class="p">,</span>
    <span class="s1">&#39;allowDiskUse&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="s1">&#39;cursor&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">executeCommand</span><span class="p">(</span><span class="nv">$database</span><span class="p">,</span> <span class="nv">$command</span><span class="p">);</span>
<span class="sd">/**</span>
<span class="sd"> * result</span>
<span class="sd"> */</span>

<span class="nv">$output</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;draw&quot;</span> <span class="o">=&gt;</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;draw&#39;</span><span class="p">],</span>
    <span class="s2">&quot;recordsTotal&quot;</span> <span class="o">=&gt;</span> <span class="nv">$recordsTotal</span><span class="p">,</span>
    <span class="s2">&quot;recordsFiltered&quot;</span> <span class="o">=&gt;</span> <span class="nv">$total</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$cursor</span> <span class="k">as</span> <span class="nv">$doc</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$finales</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$doc</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">){</span>
        <span class="nv">$finales</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="o">=</span><span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$finales</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$input[callback]</span><span class="s2">(&quot;</span><span class="o">.</span><span class="nb">json_encode</span><span class="p">(</span> <span class="nv">$output</span> <span class="p">,</span> <span class="k">true</span><span class="p">),</span><span class="s2">&quot;)&quot;</span><span class="p">;</span>
</code></pre></div>


<p>Por último, para poder probar este ejemplo, pueden utilizar los <a href="/theme/assets/others/datatables_mongodb.json" title="Descargar datos de ejemplo JSON">datos de ejemplo</a>. Es bastante sencillo poder presentar datos desde MongoDB, con ayuda del Datatables y PHP. Espero les sea de ayuda, y cualquier duda o comentario, para eso esta la sección de abajo :D</p>
<p>Saludos y agradecimiento a <a href="https://twitter.com/joel1r" title="Twitter de Joel Rivera">Joel Rivera</a> por compartirme su código.</p>
<h4>Fuentes:</h4>
<ol>
<li><a href="https://datatables.net/examples/ajax/objects.html" title="Sitio de Datatables con la documentación para AJAX">AJAX con Datatables</a></li>
<li><a href="https://docs.mongodb.com/manual/tutorial/" title="Documentación de MongoDB">Tutorial de MongoDB</a></li>
</ol>
                    </div>
<div class="meta align-right">
  Publicado el <time datetime="2019-06-12T13:00:00-05:00" pubdate="pubdate">12 de June, 2019</time>.
  Categoria «<span class="label label-primary catego"><a href="./category/php.html">Php</a></span>».  
 Etiquetado como: <span class="label label-success catego"><a href="./tag/mongodb.html">mongodb</a></span>, <span class="label label-success catego"><a href="./tag/php.html">php</a></span>, <span class="label label-success catego"><a href="./tag/datatables.html">datatables</a></span></p></div>                     <div class="sharethis-inline-share-buttons">
                        
                    </div>
                    <div><h4>Comentarios</h4>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = .colecciones-de-mongodb-con-datatables.html;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = colecciones-de-mongodb-con-datatables.html; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://davflsite.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>                    </div>
                    </div>
                    <div class="col-sm-4 col-md-4 col-sx-12 col-lg-3"><br />
<a href="/categories.html" title="Categorias y Etiquetas">Listado de Categorias y Etiquetas.</a><br />
<div class="twitter-sidebar" id="twitter-sidebar">
<a class="twitter-timeline" href="https://twitter.com/jelidleon"  data-tweet-limit="5">Tweets by jelidleon</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><div class="col-md-12">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- www.DAVFL-sidebar2 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5724119311477890"
     data-ad-slot="1367534401"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div><br />                    </div>
                </div>
<br />
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- www.DAVFL-footer -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5724119311477890"
     data-ad-slot="3263070005"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>                <br />
            </div>
        </div>

<footer class="footer">
    <div class="container">
        <nav class="pull-left">
            <ul>
                <li>
                    <a href="/author/david-leon" target="_blank" title="Más sobre mi">
                        <i class="fa fa-info"></i> Sobre mi en la red
                    </a>
                </li>
                <li>
                    <a href="/archives.html">
                       <i class="fa fa-archive"></i> Base de Conocimientos
                    </a>
                </li>
                <li>
                    <a href="https://poetadeocasion.wordpress.com/" title="Blog Poeta de Ocasión" target="_blank">
                       <i class="fa fa-heart-o"></i> d'ocasión
                    </a>
                </li>
                <li>
                    <a href="/pages/licencia.html">
                        <i class="fa fa-cc"></i> Licencia
                    </a>
                </li>
            </ul>
        </nav>
        <div class="copyright pull-right">
            <a href="/author/david-leon">David León</a>
        </div>
    </div>
</footer>    </div>
</body>
    <script src="./theme/assets/js/jquery.min.js" type="text/javascript"></script>
    <script src="./theme/assets/js/bootstrap.min.js"></script>
    <script src="./theme/assets/js/material.min.js"></script>
    <script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=58cd4861115dd2001125f1ea&product=inline-share-buttons"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-23072012-2', 'auto');
      ga('send', 'pageview');

    </script></html>